import { currentVersion,moduleLoad } from "../CommonData/data-offset"

const getWechatVersionFunction = ((): number => {
  if (currentVersion.date) {
    return currentVersion.date
  }
  const pattern = '55 8B ?? 83 ?? ?? A1 ?? ?? ?? ?? 83 ?? ?? 85 ?? 7F ?? 8D ?? ?? E8 ?? ?? ?? ?? 84 ?? 74 ?? 8B ?? ?? ?? 85 ?? 75 ?? E8 ?? ?? ?? ?? 0F ?? ?? 0D ?? ?? ?? ?? A3 ?? ?? ?? ?? A3 ?? ?? ?? ?? 8B ?? 5D C3'
  const results: MemoryScanMatch[] = Memory.scanSync(moduleLoad.base, moduleLoad.size, pattern)
  if (results.length == 0) {
    return 0
  }
  const addr: NativePointer  = results[0]!.address
  const ret: NativePointer = addr.add(0x07).readPointer()
  const ver:number = ret.add(0x0).readU32()
  currentVersion.date = ver
  return ver
})
export  {
  getWechatVersionFunction
}


